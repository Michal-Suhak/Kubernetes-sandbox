# FastAPI Configuration
fastapi:
  replicaCount: 2
  image:
    repository: fastapi-app
    tag: "v4"
    pullPolicy: Never
  service:
    type: LoadBalancer
    port: 8000
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  ingress:
    enabled: true
    host: fastapi.local

# PostgreSQL Configuration
postgresql:
  enabled: true
  image:
      registry: docker.io
      repository: postgres
      tag: "16-alpine"
  auth:
    username: fastapi_user
    database: fastapi_db
    existingSecret: "postgres-secret"
    secretKeys:
      adminPasswordKey: "POSTGRES_PASSWORD"
      userPasswordKey: "POSTGRES_PASSWORD"
  primary:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: standard

# Monitoring Configuration (Prometheus + Grafana)
kube-prometheus-stack:
  enabled: true
  grafana:
    service:
      type: LoadBalancer
      port: 3000
    # Grafana sidecar watches for ConfigMaps with special label to dynamicly load dashboards
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
        searchNamespace: ALL
  prometheus:
    service:
      type: LoadBalancer
      port: 9090
  alertmanager:
    service:
      type: LoadBalancer
      port: 9093
    config:
      global:
        resolve_timeout: 5m
      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 12h
        receiver: 'default'
      receivers:
      - name: 'default'
        # Add notification methods here (email, slack, etc.)

# Monitoring Configuration for FastAPI metrics scraping
monitoring:
  serviceMonitor:
    enabled: true
    prometheusRelease: my-fastapi-app  # Must match your Helm release name
    portName: http
    path: /metrics
    interval: 15s
    scrapeTimeout: 10s
    labels: {}  # Additional custom labels if needed
  dashboards:
    enabled: true  # Auto-load dashboards from dashboards/ directory
  alerts:
    enabled: true  # Enable Prometheus alert rules

namespace: fastapi-app
