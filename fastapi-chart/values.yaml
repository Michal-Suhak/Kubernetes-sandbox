app:
  name: fastapi  # Change to: django, flask, nodejs, etc.
  type: python   # Application type (python, nodejs, java, go, etc.)

# Deployment configuration
deployment:
  replicaCount: 2
  image:
    repository: fastapi-app  # Your application image
    tag: "v4"
    pullPolicy: Never

  # Container configuration
  container:
    port: 8000  # Application listening port

  # Resource limits
  resources:
    requests:
      memory: "256Mi"
      cpu: "200m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  env: []
  # Example:
  # env:
  #   - name: ENV_VAR_NAME
  #     value: "value"
  #   - name: SECRET_VAR
  #     valueFrom:
  #       secretKeyRef:
  #         name: my-secret
  #         key: password

# Service configuration
service:
  type: LoadBalancer
  port: 8000
  targetPort: 8000

# Ingress configuration
ingress:
  enabled: true
  host: fastapi.local  # Change to your domain
  annotations: {}
  tls: []

# PostgreSQL (via Bitnami dependency)
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: postgres
    tag: "16-alpine"
  auth:
    username: app_user  # Generic username
    database: app_db    # Generic database name
    existingSecret: "postgres-secret"
    secretKeys:
      adminPasswordKey: "POSTGRES_PASSWORD"
      userPasswordKey: "POSTGRES_PASSWORD"
  primary:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: standard

# Prometheus & Grafana stack
kube-prometheus-stack:
  enabled: true
  grafana:
    service:
      type: LoadBalancer
      port: 3000
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
        searchNamespace: ALL
  prometheus:
    service:
      type: LoadBalancer
      port: 9090
  alertmanager:
    service:
      type: LoadBalancer
      port: 9093
    config:
      global:
        resolve_timeout: 5m
      route:
        group_by: ['alertname', 'cluster', 'service']
        group_wait: 10s
        group_interval: 10s
        repeat_interval: 12h
        receiver: 'default'
      receivers:
      - name: 'default'
        # Add notification methods (email, slack, etc.)

# Application monitoring
monitoring:
  # Metrics endpoint configuration
  metrics:
    enabled: true
    path: /metrics  # Prometheus metrics endpoint
    port: http      # Service port name

  # ServiceMonitor for Prometheus scraping
  serviceMonitor:
    enabled: true
    interval: 15s
    scrapeTimeout: 10s

  # Grafana dashboards
  dashboards:
    enabled: true

  # Prometheus alerts
  alerts:
    enabled: true
    # Alert thresholds
    thresholds:
      errorRate: 0.05        # 5% error rate
      latencySeconds: 1      # 1 second p95 latency
      memoryPercent: 0.9     # 90% memory usage
      lowTrafficRate: 0.01   # 0.01 req/s minimum

# Namespace
namespace: fastapi-app  # Change to match your app

# Service Account
serviceAccount:
  create: true
  name: ""  # Auto-generated if empty

# RBAC
rbac:
  create: true

# HPA (Horizontal Pod Autoscaler)
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
